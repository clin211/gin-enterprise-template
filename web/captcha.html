<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>验证码测试</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* 自定义样式 */
        .captcha-image {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen py-8">
    <div id="app" class="max-w-2xl mx-auto px-4">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">验证码接口测试</h1>

            <!-- API 配置 -->
            <div class="mb-6 p-4 bg-gray-100 rounded-lg">
                <label class="block text-sm font-medium text-gray-700 mb-2">API 地址</label>
                <input v-model="apiBase" type="text" placeholder="http://localhost:5557"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
            </div>

            <!-- 获取验证码按钮 -->
            <div class="mb-6">
                <button @click="fetchCaptcha" :disabled="loading"
                    class="w-full bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200">
                    <span v-if="loading">获取中...</span>
                    <span v-else>获取验证码</span>
                </button>
            </div>

            <!-- 错误提示 -->
            <div v-if="error" class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md">
                {{ error }}
            </div>

            <!-- 成功提示 -->
            <div v-if="success" class="mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-md">
                {{ success }}
            </div>

            <!-- 验证码显示区域 -->
            <div v-if="captchaData" class="space-y-4">
                <!-- 验证码 ID -->
                <div class="p-4 bg-gray-50 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">验证码 ID</label>
                    <div class="text-sm text-gray-600 font-mono break-all">{{ captchaData.captchaID }}</div>
                </div>

                <!-- 验证码图片 -->
                <div class="p-4 bg-gray-50 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">验证码图片</label>
                    <div class="flex justify-center">
                        <img :src="captchaData.captchaImage" alt="验证码"
                            class="captcha-image border border-gray-300 rounded" />
                    </div>
                </div>

                <!-- 验证码输入 -->
                <div class="p-4 bg-gray-50 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">输入验证码</label>
                    <input v-model="verifyCode" type="text" placeholder="请输入验证码" maxlength="4"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-lg font-mono tracking-widest" />
                    <p class="mt-2 text-xs text-gray-500">
                        提示：验证码为 4 位数字，不区分大小写
                    </p>
                </div>

                <!-- 刷新验证码按钮 -->
                <button @click="fetchCaptcha" :disabled="loading"
                    class="w-full bg-gray-500 hover:bg-gray-600 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200">
                    <span v-if="loading">刷新中...</span>
                    <span v-else>刷新验证码</span>
                </button>
            </div>

            <!-- 响应信息（调试用） -->
            <div v-if="captchaData && showDebug" class="mt-6 p-4 bg-gray-50 rounded-lg">
                <button @click="showDebug = !showDebug" class="text-sm text-gray-600 hover:text-gray-800 mb-2">
                    {{ showDebug ? '隐藏' : '显示' }}调试信息
                </button>
                <pre v-if="showDebug"
                    class="text-xs text-gray-600 overflow-auto">{{ JSON.stringify(captchaData, null, 2) }}</pre>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    apiBase: 'http://localhost:5557',
                    loading: false,
                    error: null,
                    success: null,
                    captchaData: null,
                    verifyCode: '',
                    showDebug: false
                };
            },
            methods: {
                async fetchCaptcha() {
                    this.loading = true;
                    this.error = null;
                    this.success = null;
                    this.verifyCode = '';

                    try {
                        const url = `${this.apiBase}/captcha`;
                        const response = await fetch(url);

                        if (!response.ok) {
                            const errorData = await response.json().catch(() => ({ message: '请求失败' }));
                            throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`);
                        }

                        const data = await response.json();

                        // 检查响应格式
                        if (data.code !== 0) {
                            throw new Error(data.message || '请求失败');
                        }

                        // 从 data.data 中提取验证码信息
                        if (!data.data || !data.data.captchaID || !data.data.captchaImage) {
                            throw new Error('响应格式错误：缺少必要字段');
                        }

                        this.captchaData = {
                            captchaID: data.data.captchaID,
                            captchaImage: data.data.captchaImage
                        };

                        this.success = '验证码获取成功！';

                        // 3秒后清除成功提示
                        setTimeout(() => {
                            this.success = null;
                        }, 3000);
                    } catch (err) {
                        this.error = `获取验证码失败: ${err.message}`;
                        this.captchaData = null;
                    } finally {
                        this.loading = false;
                    }
                }
            },
            mounted() {
                // 页面加载时自动获取一次验证码
                // this.fetchCaptcha();
            }
        }).mount('#app');
    </script>
</body>

</html>